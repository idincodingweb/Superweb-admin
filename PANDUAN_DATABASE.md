# Panduan Lengkap Setup Database Supabase

## A. Membuat Project di Supabase

1. Buka website [supabase.com](https://supabase.com)
2. Klik tombol "Start your project" atau "Sign Up"
3. Login menggunakan akun GitHub atau Email
4. Setelah login, klik "New Project"
5. Isi informasi project:
   - Nama project: (bebas, misal "postpalace")
   - Password database: (buat password yang kuat)
   - Region: Pilih yang terdekat (misal Singapore)
   - Pricing Plan: Free tier
6. Klik "Create New Project"

## B. Membuat Tabel-tabel Database

Buka "SQL Editor" di menu sidebar Supabase, lalu copy-paste dan jalankan kode SQL berikut secara berurutan:

### 1. Membuat Tabel Posts

```sql
-- Tabel untuk menyimpan artikel/post
CREATE TABLE posts (
    id BIGINT GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
    title TEXT NOT NULL,
    content TEXT NOT NULL,
    category TEXT NOT NULL,
    image_url TEXT,
    created_at TIMESTAMP WITH TIME ZONE DEFAULT TIMEZONE('utc'::text, NOW()) NOT NULL,
    views BIGINT DEFAULT 0
);

-- Menambahkan komentar pada tabel
COMMENT ON TABLE posts IS 'Tabel untuk menyimpan artikel blog';
COMMENT ON COLUMN posts.id IS 'ID unik untuk setiap post';
COMMENT ON COLUMN posts.title IS 'Judul artikel';
COMMENT ON COLUMN posts.content IS 'Isi konten artikel';
COMMENT ON COLUMN posts.category IS 'Kategori artikel';
COMMENT ON COLUMN posts.image_url IS 'URL gambar cover artikel';
COMMENT ON COLUMN posts.created_at IS 'Waktu pembuatan artikel';
COMMENT ON COLUMN posts.views IS 'Jumlah view artikel';
```

### 2. Membuat Tabel Comments

```sql
-- Tabel untuk menyimpan komentar
CREATE TABLE comments (
    id BIGINT GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
    post_id BIGINT REFERENCES posts(id) ON DELETE CASCADE,
    author TEXT NOT NULL,
    content TEXT NOT NULL,
    created_at TIMESTAMP WITH TIME ZONE DEFAULT TIMEZONE('utc'::text, NOW()) NOT NULL
);

-- Menambahkan komentar pada tabel
COMMENT ON TABLE comments IS 'Tabel untuk menyimpan komentar pada artikel';
COMMENT ON COLUMN comments.id IS 'ID unik untuk setiap komentar';
COMMENT ON COLUMN comments.post_id IS 'ID artikel yang dikomentari';
COMMENT ON COLUMN comments.author IS 'Nama pemberi komentar';
COMMENT ON COLUMN comments.content IS 'Isi komentar';
COMMENT ON COLUMN comments.created_at IS 'Waktu pembuatan komentar';
```

### 3. Membuat Tabel Post Views

```sql
-- Tabel untuk statistik views
CREATE TABLE post_views (
    id BIGINT GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
    post_id BIGINT REFERENCES posts(id) ON DELETE CASCADE,
    date DATE NOT NULL,
    views BIGINT DEFAULT 0,
    UNIQUE(post_id, date)
);

-- Menambahkan komentar pada tabel
COMMENT ON TABLE post_views IS 'Tabel untuk menyimpan statistik view harian';
COMMENT ON COLUMN post_views.id IS 'ID unik untuk setiap record';
COMMENT ON COLUMN post_views.post_id IS 'ID artikel yang dilihat';
COMMENT ON COLUMN post_views.date IS 'Tanggal view';
COMMENT ON COLUMN post_views.views IS 'Jumlah view pada tanggal tersebut';
```

### 4. Mengatur Security Policies

```sql
-- Mengaktifkan Row Level Security untuk semua tabel
ALTER TABLE posts ENABLE ROW LEVEL SECURITY;
ALTER TABLE comments ENABLE ROW LEVEL SECURITY;
ALTER TABLE post_views ENABLE ROW LEVEL SECURITY;

-- Policy untuk tabel posts
CREATE POLICY "Posts dapat dilihat oleh semua orang" ON posts
    FOR SELECT USING (true);

CREATE POLICY "Posts hanya dapat dibuat oleh admin" ON posts
    FOR INSERT WITH CHECK (auth.role() = 'authenticated');

CREATE POLICY "Posts hanya dapat diupdate oleh admin" ON posts
    FOR UPDATE USING (auth.role() = 'authenticated');

CREATE POLICY "Posts hanya dapat dihapus oleh admin" ON posts
    FOR DELETE USING (auth.role() = 'authenticated');

-- Policy untuk tabel comments
CREATE POLICY "Komentar dapat dilihat oleh semua orang" ON comments
    FOR SELECT USING (true);

CREATE POLICY "Komentar dapat dibuat oleh semua orang" ON comments
    FOR INSERT WITH CHECK (true);

-- Policy untuk tabel post_views
CREATE POLICY "Statistik view dapat dilihat oleh admin" ON post_views
    FOR SELECT USING (auth.role() = 'authenticated');

CREATE POLICY "Statistik view dapat diupdate oleh sistem" ON post_views
    FOR INSERT WITH CHECK (auth.role() = 'authenticated');

CREATE POLICY "Statistik view dapat diupdate oleh sistem" ON post_views
    FOR UPDATE USING (auth.role() = 'authenticated');
```

## C. Cara Menggunakan SQL Editor di Supabase

1. Di dashboard Supabase, klik menu "SQL Editor" di sidebar kiri
2. Klik tombol "New Query" untuk membuat query baru
3. Copy-paste kode SQL di atas ke dalam editor
4. Klik tombol "Run" atau tekan Ctrl+Enter untuk menjalankan query
5. Pastikan tidak ada pesan error yang muncul

## D. Verifikasi Setup

Setelah menjalankan semua query di atas, lakukan verifikasi:

1. Klik menu "Table Editor" di sidebar
2. Pastikan tabel-tabel berikut sudah terbuat:
   - posts
   - comments
   - post_views
3. Klik setiap tabel untuk memastikan struktur kolom sudah sesuai

## E. Mengatur Authentikasi

1. Klik menu "Authentication" di sidebar
2. Klik tab "Providers"
3. Aktifkan "Email" provider
4. Nonaktifkan "Confirm Email" jika tidak ingin menggunakan verifikasi email
5. Simpan pengaturan

## F. Mendapatkan Credentials

1. Klik "Project Settings" di sidebar
2. Cari bagian "Project API keys"
3. Salin nilai dari:
   - Project URL (akan digunakan sebagai SUPABASE_URL)
   - anon/public key (akan digunakan sebagai SUPABASE_ANON_KEY)
4. Simpan kedua nilai tersebut untuk digunakan di aplikasi

## Tips Penting

1. Backup kode SQL ini untuk dokumentasi
2. Jangan pernah membagikan service_role key ke publik
3. Gunakan password database yang kuat
4. Aktifkan SSL untuk koneksi database
5. Monitor penggunaan database melalui dashboard Supabase

## Troubleshooting

Jika ada error saat menjalankan query:
1. Pastikan menjalankan query secara berurutan
2. Periksa pesan error dengan teliti
3. Pastikan tidak ada tabel yang sudah ada sebelumnya
4. Jika ada error, bisa drop tabel yang bermasalah dengan:
   ```sql
   DROP TABLE IF EXISTS nama_tabel CASCADE;
   ```
5. Kemudian ulangi pembuatan tabel tersebut
